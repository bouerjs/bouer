/*!
 * Bouer.js v3.1.0
 * Copyright Easy.js 2018-2020 | 2021-2024 Afonso Matumona
 * Released under the MIT License.
 */
var Logger=function(){var e="[Bouer]";return{log:function(t){console.log.apply(null,[e].concat(Error(t)))},error:function(t){console.error.apply(null,[e].concat(Error(t)))},warn:function(t){console.warn.apply(null,[e].concat(Error(t)))},info:function(t){console.info.apply(null,[e].concat(Error(t)))}}}(),ReactiveEvent=function(){function e(){}return e.on=function(t,n){return isNull(this.events[t])&&(this.events[t]=[]),this.events[t].push(n),{eventName:t,callback:n,off:function(){return e.off(t,n)}}},e.off=function(e,t){var n=this.events[e]||[];return n.splice(n.indexOf(t),1),!0},e.once=function(t,n){var r={},o=e.on(t,(function(e){r.onemit&&r.onemit(e)}));try{n(r)}catch(e){Logger.error(buildError(e))}finally{e.off(t,o.callback)}},e.emit=function(e,t){try{forEach(this.events[e]||[],(function(e){return e(t)}))}catch(e){Logger.error(buildError(e))}},e.events={},e}(),Prop={set:function(e,t,n){return Object.defineProperty(e,t,n)},descriptor:function(e,t){return Object.getOwnPropertyDescriptor(e,t)},transfer:function(e,t,n){var r=this.descriptor(t,n);n in e||(e[n]=void 0),this.set(e,n,r)}},Watch=function(e,t,n){var r=this;this.destroy=function(){var e=r.descriptor.watches.indexOf(r);-1!==e&&r.descriptor.watches.splice(e,1),(r.onDestroy||function(){})()},this.descriptor=e,this.property=e.propName,this.callback=t,n&&(this.node=n.node,this.onDestroy=n.onDestroy)},Reactive=function(){function e(t){var n=this;this._IRT_=!0,this.watches=[],this.fnComputed=null,this.get=function(){var e=n.computed().get;ReactiveEvent.emit("BeforeGet",n),n.propValue=n.isComputed?fnCall(e.call(n.context)):n.propValue;var t=n.propValue;return ReactiveEvent.emit("AfterGet",n),t},this.set=function(t){if(!(n.propValue===t||Number.isNaN(n.propValue)&&Number.isNaN(t))){var r=n.computed().set;if(n.isComputed&&r)fnCall(r.call(n.context,t));else if(n.isComputed&&isNull(r))return;if(n.propValueOld=n.propValue,ReactiveEvent.emit("BeforeSet",n),isObject(t)||Array.isArray(t)){if(typeof n.propValue!=typeof t)return Logger.error("Cannot set “"+typeof t+"” in “"+n.propName+"” property.");if(Array.isArray(t)){e.transform({data:t,descriptor:n,context:n.context});var o=n.propValue;o.splice(0,o.length),o.push.apply(o,t)}else isObject(t)&&(t instanceof Node?n.propValue=t:(e.transform({data:t,context:n.context}),isNull(n.propValue)?n.propValue=t:mapper(t,n.propValue)))}else n.propValue=t;ReactiveEvent.emit("AfterSet",n),n.notify()}},this.propName=t.propName,this.propSource=t.srcObject,this.context=t.context,this.baseDescriptor=Prop.descriptor(this.propSource,this.propName),this.propValue=this.baseDescriptor.value,this.isComputed="function"==typeof this.propValue&&"$computed"===this.propValue.name,this.isComputed&&(this.fnComputed=this.propValue,this.propValue=void 0),"function"!=typeof this.propValue||this.isComputed||(this.propValue=this.propValue.bind(this.context))}return e.prototype.computed=function(){if(!this.isComputed)return{get:function(){},set:function(e){}};var e=this.fnComputed.call(this.context);if(isNull(e))throw new Error("Invalid value used as return in “function $computed(){...}”.");var t=isObject(e)||isFunction(e);return{get:t&&"get"in e?e.get:function(){return e},set:t&&"set"in e?e.set:void 0}},e.prototype.notify=function(){var e=this;forEach(this.watches,(function(t){return t.callback.call(e.context,e.propValue,e.propValueOld)}))},e.prototype.onChange=function(e,t){var n=new Watch(this,e,{node:t});return this.watches.push(n),n},e.transform=function(t){var n=t.context,r=function(t,o,i,a,s){if(Array.isArray(t)){if(null==a)return Logger.warn("Cannot transform this array to a reactive one because no reactive object was provided"),t;if(-1!==o.indexOf(t))return t;o.push(t);var u=t,c={};Object.setPrototypeOf(u,Object.create(Array.prototype));var l=Object.getPrototypeOf(u);return forEach(["push","pop","unshift","shift","splice"],(function(e){c[e]=u[e].bind(u),l[e]=function(){var t=u.slice(),s=[].slice.call(arguments);switch(e){case"push":case"unshift":forEach(toArray(s),(function(e){(isObject(e)||Array.isArray(e))&&r(e,o,i)}))}var l=c[e].apply(u,s);return forEach(a.watches,(function(r){return r.callback.call(n,u,t,{method:e,args:s})})),l}})),u}return isObject(t)?(-1!==o.indexOf(t)||(o.push(t),forEach(s||Object.keys(t),(function(a){var s=t;if("value"in Prop.descriptor(t,a)){var u=s[a];if(!(u instanceof Object&&(u._IRT_||u instanceof Node))){var c=new e({propName:a,srcObject:t,context:n});Prop.set(t,a,c),Array.isArray(u)?(r(u,o,i,c),forEach(u,(function(e){return r(e,o,i)}))):isObject(u)&&r(u,o,i)}}})),o.splice(o.indexOf(t),1),i.push(t)),t):t};return r(t.data,[],[],t.descriptor)},e}(),Constants={skip:"e-skip",build:"e-build",array:"e-array",if:"e-if",elseif:"e-else-if",else:"e-else",show:"e-show",req:"e-req",for:"e-for",data:"data",def:"e-def",wait:"wait-data",text:"e-text",bind:"e-bind",property:"e-",skeleton:"e-skeleton",route:"route-view",href:":href",entry:"e-entry",on:"on:",silent:"--s",slot:"slot",ref:"ref",put:"e-put",builtInEvents:{add:"add",compile:"compile",request:"request",response:"response",fail:"fail",done:"done"},check:function(e,t){return startWith(e.nodeName,t)},isConstant:function(e){var t=this;return-1!==Object.keys(this).map((function(e){return t[e]})).indexOf(e)}},Extend=function(){var e=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n={};return forEach(e,(function(e){isNull(e)||forEach(Object.keys(e),(function(t){Prop.transfer(n,e,t)}))})),n};return{obj:e,mixin:function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var o=e.apply({},n);return forEach(Object.keys(o),(function(e){var n=e in t;if(Prop.transfer(t,o,e),n){var r=t;r[e]=fnEmpty(r[e])}})),t},array:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=[];return forEach(e,(function(e){if(!isNull(e))return Array.isArray(e)?void forEach(Object.keys(e),(function(t){var r=e[t];isNull(r)||(Array.isArray(r)?[].push.apply(n,r):n.push(r))})):n.push(e)})),n}}}();function webRequest(e,t){if(!e)return Promise.reject(new Error("Invalid Url"));var n=function(e,n){var r=(t||{})[e];return r||n},r=n("headers",{}),o=n("method","get"),i=n("body",void 0),a=n("body",(function(e){})),s=function(e){if(!(!DOM.documentMode||e.match(/^(get|post)$/i)&&WIN.XMLHttpRequest))return new WIN.ActiveXObject("Microsoft.XMLHTTP");if(WIN.XMLHttpRequest)return new WIN.XMLHttpRequest;throw new Error("This browser does not support XMLHttpRequest.")}(o);return new Promise((function(t,n){var u=function(t,n,r,o,i){t({url:e,ok:n,status:r,statusText:o.statusText||"",headers:o.getAllResponseHeaders(),json:function(){return Promise.resolve(JSON.stringify(i))},text:function(){return Promise.resolve(i)}})};s.open(o,e,!0),forEach(Object.keys(r),(function(e){s.setRequestHeader(e,r[e])})),s.onload=function(){var n="response"in s?s.response:s.responseText,r=1223===s.status?204:s.status;0===r&&(r=n?200:"file"===urlResolver(e).protocol?404:0),u(t,r>=200&&r<400,r,s,n)},s.onerror=function(){u(n,!1,s.status,s,"")},s.onabort=function(){u(n,!1,s.status,s,"")},s.ontimeout=function(){u(n,!1,s.status,s,"")},a(s),s.send(i)}))}function code(e,t,n){for(var r="01234567890ABCDEFGHIJKLMNOPQRSTUVWXYZ",o="",i=!1,a=0;a<(e||8);a++){var s=Math.floor(Math.random()*r.length);o+=i?toLower(r[s]):r[s],i=!i}return(t||"")+o+(n||"")}function isNull(e){return void 0===e||null==e}function isObject(e){return"object"==typeof e&&"[object Object]"===String(e)}function isFilledObj(e){if(isEmptyObject(e))return!1;for(var t=!1,n=Object.keys(e),r=0;r<n.length;r++)if(!isNull(n[r])){t=!0;break}return t}function isPrimitive(e){return"string"==typeof e||"number"==typeof e||"symbol"==typeof e||"boolean"==typeof e}function isString(e){return void 0!==e&&"string"==typeof e}function isEmptyObject(e){return!e||!isObject(e)||0===Object.keys(e).length}function isFunction(e){return"function"==typeof e}function ifNullReturn(e,t){return isNull(e)?t:e}function ifNullStop(e){if(isNull(e))throw new Error("Application is not initialized");return e}function trim(e){return e?e.trim():e}function startWith(e,t){return e.substring(0,t.length)===t}function toLower(e){return e.toLowerCase()}function toStr(e){return isPrimitive(e)?String(e):isObject(e)||Array.isArray(e)?JSON.stringify(e):isFunction(e.toString)?e.toString():String(e)}function forEach(e,t,n){for(var r=0;r<e.length;r++)t.call(n,e[r],r)}function where(e,t,n){for(var r=[],o=0;o<e.length;o++)t.call(n,e[o],o)&&r.push(e[o]);return r}function toArray(e){return e?[].slice.call(e):[]}function createComment(e,t){var n=DOM.createComment(t||" e ");return n.id=e||code(8),n}function createAnyEl(e,t){return createEl(e,t)}function createEl(e,t){var n=DOM.createElement(e);isFunction(t)&&t(n,DOM);var r={appendTo:function(e){return e.appendChild(n),r},build:function(){return n},child:function(){return n.children[0]},children:function(){return[].slice.call(n.childNodes)}};return r}function removeEl(e){var t=e.parentNode;t&&t.removeChild(e)}function mapper(e,t){forEach(Object.keys(e),(function(n){var r=e[n];if(n in t)return isObject(r)?mapper(r,t[n]):t[n]=r;Prop.transfer(t,e,n)}))}function urlResolver(e){var t=e;"documentMode"in DOM&&(anchor.setAttribute("href",t),t=anchor.href),anchor.href=t;var n=anchor.hostname;!("[::1]"===anchor.hostname)&&n.indexOf(":")>-1&&(n="["+n+"]");var r={href:anchor.href,baseURI:anchor.baseURI,protocol:anchor.protocol?anchor.protocol.replace(/:$/,""):"",host:anchor.host,search:anchor.search?anchor.search.replace(/^\?/,""):"",hash:anchor.hash?anchor.hash.replace(/^#/,""):"",hostname:n,port:anchor.port,pathname:"/"===anchor.pathname.charAt(0)?anchor.pathname:"/"+anchor.pathname,origin:""};return r.origin=r.protocol+"://"+r.host,r}function urlCombine(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=e.split(/\/\//),o=r.length>1?r[0]+"//":"",i=(""===o?r[0]:r[1]).split(/\//),a=[];return forEach(i,(function(e){return trim(e)?a.push(e):null})),forEach(t,(function(e){return forEach(e.split(/\//),(function(e){return trim(e)?a.push(e):null}))})),o+a.join("/")}function pathResolver(e,t){var n=function(e){return"../"===e.substring(0,3)},r=function(e){var t=e.split("/");return/\.html$|\.css$|\.js$/gi.test(e)&&t.pop(),{relative:t.join("/"),parts:t}};if("./"===t.substring(0,2))return r(e).relative+t.substring(1);if(!n(t))return t;var o=r(e).parts;return o.push(function e(t){return n(t)?(o.pop(),e(t.substring(3))):t}(t)),o.join("/")}function buildError(e){return e?(e.stack="",e):"Unknown Error"}function fnEmpty(e){return e}function fnCall(e){return e instanceof Promise&&e.then((function(e){isFunction(e)?e.call():e instanceof Promise&&e.then()})).catch((function(e){return Logger.error(e)})),e}function findAttribute(e,t,n){void 0===n&&(n=!1);var r=null;if(!e)return null;for(var o=0;o<t.length&&!(r=e.attributes[t[o]]);o++);return!isNull(r)&&n&&e.removeAttribute(r.name),r}function findDirective(e,t){var n=e.attributes||[];return n.getNamedItem(t)||toArray(n).find((function(e){return e.name===t||startWith(e.name,t+":")}))}function getRootElement(e){return e.root||e}function copyObject(e){var t=Object.create(e.__proto__);return forEach(Object.keys(e),(function(n){return t[n]=e[n]})),t}function setData(e,t,n){return isNull(n)&&(n=e.data),isObject(t)?isObject(n)&&null==n?(Logger.error('Invalid targetObject value, expected an "Object Literal" and got "'+typeof n+'".'),t):(Reactive.transform({data:t,context:e}),forEach(Object.keys(t),(function(e){var r,o;ReactiveEvent.once("AfterGet",(function(n){n.onemit=function(e){return r=e},Prop.descriptor(t,e).get()})),ReactiveEvent.once("AfterGet",(function(t){t.onemit=function(e){return o=e};var r=Prop.descriptor(n,e);r&&isFunction(r.get)&&r.get()})),Prop.transfer(n,t,e),o&&r&&(forEach(o.watches,(function(e){-1===r.watches.indexOf(e)&&r.watches.push(e)})),r.notify())})),n):(Logger.error('Invalid inputData value, expected an "Object Literal" and got "'+typeof t+'".'),n)}function htmlToJsObj(e,t,n){var r=void 0;if(e instanceof HTMLElement)r=e;else if("string"==typeof e)try{var o=DOM.querySelector(e);if(!o)return Logger.error('Element with "'+e+'" selector Not Found.'),null;r=o}catch(e){return Logger.error(buildError(e)),null}if(isNull(r))throw Logger.error('Invalid element provided at app.toJsObj(> "'+e+'" <).');var i=((t=t||{}).names||"[name]").replace(/\[|\]/g,"").split(","),a=(t.values||"[value]").replace(/\[|\]/g,"").split(","),s=function(e,t){return t in e?e[t]:e.getAttribute(t)||e.innerText},u=function(e){var t={},r={BUTTON:!0},o={checkbox:!0,radio:!0};return function e(u){var c=findAttribute(u,i);if(c){var l=c.value;if(!0===r[u.tagName])return;if(u instanceof HTMLInputElement&&!0===o[u.type]&&!1===u.checked)return;var f=t[l],d=u.hasAttribute(Constants.array),p=function(e){var t=void 0;return a.find((function(n){return!!(t=s(e,n))})),t}(u);""!==p&&(t[l]=d?f?Extend.array(f,p):[p]:f?Extend.array(f,p):p),isFunction(n)&&fnCall(n(t,l,p,u))}forEach(toArray(u.children),(function(t){findAttribute(t,[Constants.build])||e(t)}))}(e),t},c=u(r);return forEach(toArray(r.querySelectorAll("[".concat(Constants.build,"]"))),(function(e){var t=s(e,Constants.build),r=e.hasAttribute(Constants.array),o=u(e);isFilledObj(o)&&function t(i,a){var s=i.split("."),u=s[0];s.shift();var c=a[u];return isNull(c)&&(a[u]={}),0===s.length?(r?isObject(c)&&!isEmptyObject(c)?a[u]=[Extend.obj(c,o)]:Array.isArray(c)?c.push(o):a[u]=[o]:isNull(c)?a[u]=o:a[u]=Extend.obj(c,o),void(isFunction(n)&&fnCall(n(a,u,o,e)))):Array.isArray(c)?forEach(c,(function(e){t(s.join("."),e)})):void t(s.join("."),a[u])}(t,c)})),c}var WIN=window,DOM=document,anchor=createEl("a").build(),DelimiterHandler=function(){function e(e,t){this.delimiters=[],this.bouer=e,this.delimiters=t}return e.prototype.add=function(e){this.delimiters.push(e)},e.prototype.remove=function(e){var t=this.delimiters.findIndex((function(t){return t.name===e}));this.delimiters.splice(t,1)},e.prototype.run=function(e){var t=this;if(isNull(e)||""===trim(e))return[];var n=null,r=function(e,r){for(var o=0;o<t.delimiters.length;o++){var i=t.delimiters[o],a=e.match(RegExp(i.delimiter.open+"([\\S\\s]*?)"+i.delimiter.close,r||""));if(a)return n=i,a}},o=r(e,"g");return o?o.map((function(e){var t=r(e);return{field:t[0],expression:trim(t[1]),delimiter:n}})):[]},e.prototype.shorthand=function(e){if(isNull(e)||""===trim(e))return null;var t=e.match(new RegExp("{([\\w{$,-}]*?)}"));return t?{field:t[0],expression:trim(t[1])}:null},e}(),Evaluator=function(){function e(e){this.bouer=e}return e.prototype.execRaw=function(e,t){try{Function(e).call(t||this.bouer)}catch(e){Logger.error(buildError(e))}},e.prototype.exec=function(t){var n=Extend.obj(this.bouer.globalData||{},t.aditional||{},t.data||{},{$root:this.bouer.data,$mixin:Extend.mixin});return delete t.data,t.data=n,e.run(t)},e.run=function(e){try{return Function("var d$=arguments[0].d;return(function(){var r$;with(d$){"+(!1===e.isReturn?"":"r$=")+e.code+"}return r$;}).apply(this, arguments[0].a)").call(e.context,{d:e.data||{},a:e.args})}catch(e){Logger.error(buildError(e))}},e}(),Skeleton=function(){function e(e){var t=this;this._IRT_=!0,this.backgroudColor="",this.waveColor="",this.defaultBackgroudColor="#E2E2E2",this.defaultWaveColor="#ffffff5d",this.identifier="bouer",this.numberOfItems=1,this.reset(),this.bouer=e,this.style=createEl("style",(function(e){return e.id=t.identifier})).build()}return e.prototype.reset=function(){this.backgroudColor=this.defaultBackgroudColor,this.waveColor=this.defaultWaveColor},e.prototype.init=function(e){var t=this;if(this.style&&(DOM.getElementById(this.identifier)||DOM.head.appendChild(this.style),this.style.sheet)){for(var n=0;n<this.style.sheet.cssRules.length;n++)this.style.sheet.deleteRule(n);e?(this.backgroudColor=e.background||this.defaultBackgroudColor,this.waveColor=e.wave||this.defaultWaveColor,this.numberOfItems=e.numberOfItems||this.numberOfItems):this.reset();var r=Constants.skeleton,o=this.backgroudColor,i=["[--s]{ display: none!important; }","["+r+"] { background-color: "+o+"!important; position: relative!important; overflow: hidden; }","["+r+"],["+r+"] * { color: transparent!important; }","["+r+"]::before, ["+r+']::after { content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0; display: block; }',"["+r+"]::before { background-color: "+o+"!important; z-index: 1;}","["+r+"]::after { transform: translateX(-100%); background: linear-gradient(90deg, transparent, "+this.waveColor+", transparent); animation: loading 1.5s infinite; z-index: 2; }","@keyframes loading { 100% { transform: translateX(100%); } }","@-webkit-keyframes loading { 100% { transform: translateX(100%); } }"];forEach(i,(function(e){return t.style.sheet.insertRule(e)})),this.style.innerText=i.join(" ")}},e.prototype.insertItems=function(e){var t=e.parentElement||e.parentNode,n=e;if(null!=t&&!(this.numberOfItems<=1)&&(n.hasAttribute("e-skeleton")||!isNull(n.querySelector("[e-skeleton]")))){var r=code(6);e.setAttribute("skeleton-clone-code",r);for(var o=0;o<this.numberOfItems-1;o++){var i=e.cloneNode(!0);i.setAttribute("skeleton-cloned",r),t.insertBefore(i,e)}}},e.prototype.clearItems=function(e){var t=e,n=e.parentElement||e.parentNode,r=t.getAttribute("skeleton-clone-code");r&&(t.removeAttribute("skeleton-clone-code"),forEach([].slice.call(n.querySelectorAll('[skeleton-cloned="'+r+'"]')),(function(e){n.removeChild(e)})))},e.prototype.clear=function(e){e=e?'="'+e+'"':"",forEach(toArray(ifNullStop(this.bouer.el).querySelectorAll("["+Constants.skeleton+e+"]")),(function(e){return e.removeAttribute(Constants.skeleton)}))},e}(),IoC=function(){var e=1,t=new WeakMap,n=function(e,t){var n=[],r={__ctor0:e};return forEach(t||[],(function(e,t){var o="__arg"+t;r[o]=e,n.push(o)})),Evaluator.run({code:"new __ctor0("+n.join(",")+")",data:r,isReturn:!0})};return{app:function(e){return{add:function(n,r,o){return function(e,n,r,o){if(e.isDestroyed)throw new Error("Application already disposed.");t.has(e)||t.set(e,new WeakMap),t.get(e).set(n,{clazz:n,isSingleton:ifNullReturn(o,!1),args:r})}(e,n,r,o)},resolve:function(r){return function(e,r){if(e.isDestroyed)throw new Error("Application already disposed.");var o=t.get(e);if(!o)return null;var i=o.get(r);return null==i?null:i.isSingleton?i.instance?i.instance:i.instance=n(r,i.args):n(r,i.args)}(e,r)},clear:function(){!function(e){t.delete(e)}(e)}}},new:function(e,t){return e instanceof Bouer?(Logger.error("Cannot create an instance of Bouer using IoC"),null):n(e,t)},newId:function(){return e++}}}(),Task={run:function(e,t){var n=setInterval((function(){e((function(){return clearInterval(n)}))}),t||10)}},Middleware=function(e){var t=this;this._IRT_=!0,this.middlewareConfigContainer={},this.run=function(e,n){var r=t.middlewareConfigContainer[e];if(!r)return(n.default||function(){}).call(t.bouer);for(var o=0,i=r[o],a=function(){var e=!1,a=i[n.type];if(a?n.action((function(n,r){Promise.resolve(a.call(t.bouer,n,(function(){e=!0}))).then((function(t){e||r.success(t),r.done()})).catch((function(t){e||r.fail(t),r.done()}))})):(n.default||function(){})(),0==e)return"break";i=r[++o]};null!=i&&"break"!==a(););},this.subscribe=function(e,n){t.middlewareConfigContainer[e]||(t.middlewareConfigContainer[e]=[]);var r={};n.call(t.bouer,(function(e){return r.onBind=e}),(function(e){return r.onUpdate=e})),t.middlewareConfigContainer[e].push(r)},this.has=function(e){var n=t.middlewareConfigContainer[e];return!!n&&n.length>0},this.bouer=e},Binder=function(){function e(e){this.binds=[],this.DEFAULT_BINDER_PROPERTIES={text:"value",number:"valueAsNumber",checkbox:"checked",radio:"value",contenteditable:"textContent"},this.BindingDirection={fromInputToData:"fromInputToData",fromDataToInput:"fromDataToInput"},this.bouer=e,this.evaluator=IoC.app(e).resolve(Evaluator),this.cleanup()}return e.prototype.create=function(e){var t=this,n=e.node,r=e.data,o=e.fields,i=e.isReplaceProperty,a=e.context,s=trim(ifNullReturn(n.nodeValue,"")),u=n.nodeName,c=n.ownerElement||n.parentNode,l=IoC.app(this.bouer).resolve(Middleware),f=e.onUpdate||function(e,t){},d={node:n,data:r,nodeName:u,nodeValue:s,fields:o,parent:c,value:""},p=function(e){l.run(u,{type:e,action:function(e){e({binder:d,detail:{}},{success:function(){},fail:function(){},done:function(){}})}})};return u.substring(0,Constants.bind.length)===Constants.bind?function(){var o="",i=c.type;c.hasAttribute("contenteditable")&&(i="contenteditable"),i=i||c.localName,o=Constants.bind===u?t.DEFAULT_BINDER_PROPERTIES[i]||"value":u.split(":")[1];var l,h,v=c instanceof HTMLSelectElement,m=v&&!0===c.multiple,b=findAttribute(c,[":value"],!0),g=b?b.value:"'"+c.value+"'",y=trim(s),C={fromDataToInput:function(e){if(!Array.isArray(l)){if("radio"===i)return c.checked=c[o]==e;var n=isObject(e)?toStr(e):isNull(e)?"":e;if(n===c[o])return;return c[o]=n}if(h=h||t.evaluator.exec({data:r,code:g,context:a}),m)return forEach(toArray(c.options),(function(e){e.selected=-1!==l.indexOf(trim(e.value))}));if(-1===l.indexOf(h))switch(typeof c[o]){case"boolean":c[o]=!1;break;case"number":c[o]=0;break;default:c[o]=""}},fromInputToData:function(e){if(!Array.isArray(l))return t.evaluator.exec({isReturn:!1,context:a,data:Extend.obj(r,{$vl:e}),code:y+"=$vl"});if(h=h||t.evaluator.exec({data:r,code:g,context:a}),m){var n=[];return forEach(toArray(c.options),(function(e){!0===e.selected&&n.push(trim(e.value))})),l.splice(0,l.length),l.push.apply(l,n)}e?l.push(h):l.splice(l.indexOf(h),1)}},N=function(e,t){return v&&!m&&Array.isArray(l)&&!g?Logger.error("Since it's a <select> array binding, it expects the “multiple” attribute in order to bind the multiple values."):m||!Array.isArray(l)||g?C[e](t):Logger.error('Since it\'s an array binding it expects a model but it has not been defined, provide a model as it follows: value="String-Model" or :value="Object-Model".')};ReactiveEvent.once("AfterGet",(function(o){var i=function(){return t.evaluator.exec({data:r,code:y,context:a})};o.onemit=function(r){t.binds.push({isConnected:e.isConnected,watch:r.onChange((function(){p("onUpdate");var e=i();N(t.BindingDirection.fromDataToInput,e),f(e,n)}),n)})},l=i()})),p("onBind"),N(t.BindingDirection.fromDataToInput,l);var E=["input","propertychange","change"];return-1===E.indexOf(c.localName)&&E.push(c.localName),forEach(E,(function(e){"change"===e&&"select"!==c.localName||c.addEventListener(e,(function(){N(t.BindingDirection.fromInputToData,c[o])}),!1)})),c.removeAttribute(n.nodeName),d}():function(){var l=n;u.substring(0,Constants.property.length)===Constants.property&&isNull(i)&&(d.nodeName=u.substring(Constants.property.length),c.setAttribute(d.nodeName,s),l=c.attributes[d.nodeName],c.removeAttribute(n.nodeName));var h=function(){var e=d.nodeValue,i=!1;if(forEach(o,(function(o){var s=o.delimiter;s&&"html"===s.name&&(i=!0);var u=t.evaluator.exec({data:r,code:o.expression,context:a});u=isNull(u)?"":u,e=e.replace(o.field,toStr(u)),s&&"function"==typeof s.onUpdate&&(e=s.onUpdate(e,n,r))})),d.value=e,!i)return l.nodeValue=e;var s=createEl("div",(function(t){return t.innerHTML=e})).children();c.innerHTML="",forEach(s,(function(e){c.appendChild(e),IoC.app(t.bouer).resolve(Compiler).compile({el:e,data:r,context:a})}),t)};return ReactiveEvent.once("AfterGet",(function(r){r.onemit=function(r){t.binds.push({isConnected:e.isConnected,watch:r.onChange((function(){p("onUpdate"),h(),f(r.propValue,n)}),n)})},h()})),p("onBind"),d.node=l,d}()},e.prototype.remove=function(e,t,n){this.binds=where(this.binds,(function(r){var o=r.watch.node;return(o.ownerElement||o.parentElement)!==e||(isNull(t)?r.watch.destroy():o.nodeName!==t||n!==r.watch.property&&!isNull(n)||r.watch.destroy())}))},e.prototype.onPropertyChange=function(e,t,n){var r;return ReactiveEvent.once("AfterGet",(function(o){o.onemit=function(e){return r=e.onChange(t)},fnEmpty(n[e])})),r},e.prototype.onPropertyInScopeChange=function(e){var t=this,n=[];return ReactiveEvent.once("AfterGet",(function(r){r.onemit=function(r){if(!n.find((function(e){return e.property===r.propName&&e.descriptor.propSource===r.propSource}))){var o=!1;n.push(r.onChange((function(){o||(o=!0,e.call(t.bouer,t.bouer),o=!1)})))}},e.call(t.bouer,t.bouer)})),{watches:n,destroy:function(){return forEach(n,(function(e){return e.destroy()}))}}},e.prototype.cleanup=function(){var e=this;0!=ifNullReturn(this.bouer.config.autoUnbind,!0)&&Task.run((function(){e.binds=where(e.binds,(function(e){if(e.isConnected())return!0;e.watch.destroy()}))}))},e}(),EventHandler=function(){function e(e,t){this._IRT_=!0,this.$events={},this.input=createEl("input").build(),this.bouer=e,this.evaluator=IoC.app(e).resolve(Evaluator),this.cleanup()}return e.prototype.compile=function(e,t,n){var r=this,o=e.ownerElement||e.parentNode,i=e.nodeName;if(isNull(o))return Logger.error("Invalid ParentElement of “"+i+"”");var a=trim(ifNullReturn(e.nodeValue,"")),s=i.substring(Constants.on.length).split("."),u=s[0];if(s.shift(),""===a)return Logger.error("Expected an expression in the “"+i+"” and got an <empty string>.");o.removeAttribute(i);var c=function(e){var o={prevent:"preventDefault",stop:"stopPropagation"};forEach(s,(function(t){var n=o[t];e[n]&&e[n]()}));var i=[e],u=r.evaluator.exec({data:t,code:a,args:i,aditional:{event:e},context:n});if(isFunction(u))try{u.apply(n,i)}catch(e){Logger.error(buildError(e))}},l={},f=["capture","once","passive"];forEach(s,(function(e){e=e.toLocaleLowerCase(),-1!==f.indexOf(e)&&(l[e]=!0)})),"on"+u in this.input?o.addEventListener(u,c,l):this.on({eventName:u,callback:c,modifiers:l,context:n,attachedNode:o})},e.prototype.on=function(e){var t=this,n=this,r=e.eventName,o=e.callback,i=e.context,a=e.attachedNode,s=e.modifiers,u=function(e){return o.apply(i||t.bouer,[e])},c={eventName:r,attachedNode:a,modifiers:s,callback:u,destroy:function(){return n.off({callback:u,attachedNode:a,eventName:r})},emit:function(e){return t.emit({eventName:r,attachedNode:a,init:(e||{}).init,once:(e||{}).once})}};return this.$events[r]||(this.$events[r]=[]),this.$events[r].push(c),c},e.prototype.off=function(e){var t=e.eventName,n=e.callback,r=e.attachedNode;this.$events[t]&&(this.$events[t]=where(this.$events[t],(function(e){var o=e.eventName===t&&n==e.callback;return(!r||e.attachedNode!==r||!o)&&(e.eventName===t&&e.attachedNode===r&&isNull(n)?void 0:!o)})))},e.prototype.emit=function(e){var t=this,n=e.eventName,r=e.init,o=e.once,i=e.attachedNode,a=this.$events[n];if(a){var s=function(e,t){e.addEventListener(n,t,{once:!0}),e.dispatchEvent(new CustomEvent(n,r))};this.$events[n]=where(a,(function(e){var a=e.attachedNode,u=ifNullReturn((e.modifiers||{}).once,!1)||ifNullReturn(o,!1);return i?a!==i||(s(a,e.callback),!u):a?(s(a,e.callback),!u):(fnCall(e.callback.call(t.bouer,new CustomEvent(n,r))),!u)}))}},e.prototype.cleanup=function(){var e=this;0!=ifNullReturn(this.bouer.config.autoOffEvent,!0)&&Task.run((function(){forEach(Object.keys(e.$events),(function(t){e.$events[t]=where(e.$events[t],(function(e){return!1===(e.modifiers||{}).autodestroy||(!e.attachedNode||(!!e.attachedNode.isConnected||void 0))}))}))}))},e}(),Routing=function(){function e(e){this._IRT_=!0,this.routeView=null,this.activeAnchors=[],this.base=null,this.bouer=e}return e.prototype.init=function(){var e=this;if(this.routeView=ifNullStop(this.bouer.el).querySelector("[route-view]"),!isNull(this.routeView)){this.routeView.removeAttribute("route-view"),this.base="/";var t=DOM.head.querySelector("base");if(t){var n=t.attributes.getNamedItem("href");if(!n)return Logger.error('The href="/" attribute is required in base element.');this.base=n.value}this.defaultPage&&this.navigate(DOM.location.href),WIN.addEventListener("popstate",(function(t){t.preventDefault(),e.navigate((t.state||{}).url||location.href,{setURL:!1})}))}},e.prototype.navigate=function(e,t){var n=this;if(this.routeView){if(isNull(e))return Logger.log("Invalid url provided to the navigation method.");var r=urlResolver(e=trim(e)),o=ifNullReturn(this.bouer.config.usehash,!0),i=(o?r.hash:r.pathname).split("?")[0];t=t||{},"/"===i[i.length-1]&&(i=i.substring(0,i.length-1));var a=this.toPage(i);if(this.clear(),a&&(a||!e.endsWith(".html"))){var s=createAnyEl(a.name,(function(e){e.setAttribute("data",isObject(t.data)?JSON.stringify(t.data):"$data")})).appendTo(this.routeView).build();DOM.title=a.title||DOM.title,ifNullReturn(t.setURL,!0)&&this.pushState(r.href,DOM.title);var u=urlCombine(r.baseURI,o?"#":"",a.route);IoC.app(this.bouer).resolve(ComponentHandler).order(s,this.bouer.data,(function(){n.markActiveAnchorsWithRoute(u)}))}}},e.prototype.pushState=function(e,t){e=urlResolver(e).href,DOM.location.href!==e&&WIN.history.pushState({url:e,title:t},t||"",e)},e.prototype.popState=function(e){isNull(e)&&(e=-1),WIN.history.go(e)},e.prototype.toPage=function(e){return""===e||"/"===e||e==="/"+urlCombine((this.base,"index.html"))?this.defaultPage:IoC.app(this.bouer).resolve(ComponentHandler).find((function(t){if(!t.route)return!1;var n=t.route.replace(/{(.*?)}/gi,"[\\S\\s]{1,}");return!!Array.isArray(new RegExp("^"+n+"$","i").exec(e))}))||this.notFoundPage},e.prototype.markActiveAnchorsWithRoute=function(e){var t=this,n=this.bouer.config.activeClassName||"active-link",r=ifNullStop(this.bouer.el),o=r.querySelectorAll("a");isNull(e)||(forEach(this.activeAnchors,(function(e){return e.classList.remove(n)})),forEach([].slice.call(r.querySelectorAll("a."+n)),(function(e){return e.classList.remove(n)})),this.activeAnchors=[],forEach(toArray(o),(function(r){r.href.split("?")[0]===e.split("?")[0]&&(r.classList.add(n),t.activeAnchors.push(r))})))},e.prototype.markActiveAnchor=function(e){var t=this.bouer.config.activeClassName||"active-link";isNull(e)||(forEach(this.activeAnchors,(function(e){return e.classList.remove(t)})),forEach([].slice.call(ifNullStop(this.bouer.el).querySelectorAll("a."+t)),(function(e){return e.classList.remove(t)})),e.classList.add(t),this.activeAnchors=[e])},e.prototype.clear=function(){this.routeView.innerHTML=""},e.prototype.configure=function(e){return!0!==e.isDefault||isNull(this.defaultPage)?!0!==e.isNotFound||isNull(this.notFoundPage)?(!0===e.isDefault&&(this.defaultPage=e),void(!0===e.isNotFound&&(this.notFoundPage=e))):Logger.warn("There are multiple “NotFound Page” provided, check the “"+e.route+"” route."):Logger.warn("There are multiple “Default Page” provided, check the “"+e.route+"” route.")},e}(),DataStore=function(){function e(){this._IRT_=!0,this.wait={},this.data={},this.req={}}return e.prototype.set=function(e,t,n){if("wait"===e)return Logger.warn("Only “get” is allowed for type of data");this[e][t]=n},e.prototype.get=function(e,t,n){var r=this[e][t];return!0===n&&this.unset(e,t),r},e.prototype.unset=function(e,t){delete this[e][t]},e}(),Directive=function(){function e(e,t,n){this._IRT_=!0,this.$custom={},this.errorMsgEmptyNode=function(e){return"Expected an expression in “"+e.nodeName+"” and got an <empty string>."},this.errorMsgNodeValue=function(e){return"Expected an expression in “"+e.nodeName+"” and got “"+ifNullReturn(e.nodeValue,"")+"”."},this.compiler=t,this.context=n,this.bouer=t.bouer,this.$custom=e,this.evaluator=IoC.app(this.bouer).resolve(Evaluator),this.delimiter=IoC.app(this.bouer).resolve(DelimiterHandler),this.binder=IoC.app(this.bouer).resolve(Binder),this.eventHandler=IoC.app(this.bouer).resolve(EventHandler)}return e.prototype.toOwnerNode=function(e){return e.ownerElement||e.parentNode},e.prototype.skip=function(e){e.nodeValue="true"},e.prototype.if=function(e,t){var n=this,r=this.toOwnerNode(e),o=r.parentElement;if(o){var i=[],a=createComment(),s=e.nodeName,u=function(){};if(s!==Constants.elseif&&s!==Constants.else){var c=r,l=[],f=function(){if(null==c)return"break";var e=findAttribute(c,["e-if","e-else-if","e-else"]);if(!e)return"break";var r=i[0];return"e-if"===e.name&&r&&e.name===r.attr.name?"break":"e-else"!==e.nodeName&&""===trim(ifNullReturn(e.nodeValue,""))?{value:Logger.error(d.errorMsgEmptyNode(e))}:0!==d.delimiter.run(ifNullReturn(e.nodeValue,"")).length?{value:Logger.error(d.errorMsgNodeValue(e))}:(i.push({attr:e,node:c}),"e-else"===e.nodeName?(c.removeAttribute(e.nodeName),"break"):(ReactiveEvent.once("AfterGet",(function(r){r.onemit=function(t){-1===l.findIndex((function(e){return e.descriptor.propName==t.propName}))&&l.push({attr:e,descriptor:t})},n.evaluator.exec({data:t,code:e.value,context:n.context})})),void c.removeAttribute(e.nodeName)))},d=this;do{var p=f();if("object"==typeof p)return p.value;if("break"===p)break}while(c=c.nextElementSibling);var h=function(){return!isNull(Extend.array(i.map((function(e){return e.node})),a).find((function(e){return e.isConnected})))};forEach(l,(function(e){n.binder.binds.push({isConnected:h,watch:e.descriptor.onChange((function(){return u()}),e.attr)})})),(u=function(){forEach(i,(function(e){var t=getRootElement(e.node);t.parentElement&&(a.isConnected?o.removeChild(t):o.replaceChild(a,t))}));var e=i.map((function(e,t){var n=e.attr.value;switch(e.attr.name){case Constants.if:return"if("+n+"){ __cb("+t+"); }";case Constants.elseif:return"else if("+n+"){ __cb("+t+"); }";case Constants.else:return"else{ __cb("+t+"); }"}})).join(" ");n.evaluator.exec({data:t,isReturn:!1,code:e,context:n.context,aditional:{__cb:function(e){var r=getRootElement(i[e].node);o.replaceChild(r,a),n.compiler.compile({el:r,data:t,context:n.context,isConnected:h})}}})})()}}},e.prototype.show=function(e,t){var n=this,r=this.toOwnerNode(e),o=trim(ifNullReturn(e.nodeValue,"")),i=function(e){};if(""===o)return Logger.error(this.errorMsgEmptyNode(e));if(0!==this.delimiter.run(o).length)return Logger.error(this.errorMsgNodeValue(e));var a=this.binder.create({data:t,node:e,isConnected:function(){return r.isConnected},fields:[{expression:o,field:o}],context:this.context,onUpdate:function(){return i(r)}});(i=function(e){e.style.display=n.evaluator.exec({data:t,code:o,context:n.context})?"":"none"})(r),r.removeAttribute(a.node.nodeName)},e.prototype.for=function(e,t){var n=this,r=this.toOwnerNode(e),o=r.parentElement;if(o&&!r.hasAttribute("skeleton-cloned")){var i=createComment(),a=e.nodeName,s=trim(ifNullReturn(e.nodeValue,"")),u=[],c=!1,l=!1,f=function(){};if(""===s)return Logger.error(this.errorMsgEmptyNode(e));if(!s.includes(" of ")&&!s.includes(" in "))return Logger.error("Expected a valid “for” expression in “"+a+"” and got “"+s+'”.\nValid: e-for="item of items".');var d=this.delimiter.run(s);0!==d.length&&this.binder.create({node:e,data:t,fields:d,isReplaceProperty:!0,context:this.context,isConnected:function(){return i.isConnected},onUpdate:function(){return f()}}),r.removeAttribute(a);var p=r.cloneNode(!0);o.replaceChild(i,r);var h=function(r){var a=function(r,o){var i=(g=g||v(trim(ifNullReturn(e.nodeValue,"")))).leftHandParts,a=g.sourceValue,s=g.isForOf,u=Extend.obj(t),c=i[0],l=i[1]||"_index_or_value",f=i[2]||"_for_in_index";return u[c]=r,u[l]=s?o:a[r],u[f]=o,Reactive.transform({data:u,context:n.context})}(r.item,r.index),s=o.insertBefore(p.cloneNode(!0),r.reference||i);return n.compiler.compile({el:s,data:a,context:n.context,onDone:function(e){return n.eventHandler.emit({eventName:Constants.builtInEvents.add,attachedNode:e,once:!0})}}),u.splice(r.index,0,{el:s,data:a}),s},v=function(e){var r=e.split("|").map((function(e){return trim(e)})),o=r[0].replace(/\(|\)/g,"");r.shift();var i=" of ",a=o.split(i);a.length>1||(a=o.split(i=" in "));var s=a[0],u=a[1],c=s.split(",").map((function(e){return trim(e)})),l="of"===trim(i)?u:"Object.keys("+u+")";return{filters:r,type:i,leftHand:s,rightHand:u,sourceValue:n.evaluator.exec({data:t,code:u,context:n.context}),leftHandParts:c,iterableExpression:l,isForOf:"of"===trim(i)}},m=function(e,r){var o=r.split(":").map((function(e){return trim(e)}));if(1!=o.length)return function(e,r){c=!0;var o=r[2],i=r[1];if(isNull(i)||""===i)return Logger.error("Invalid where-value in “"+a+"” with “"+s+"” expression."),e;if("function"==typeof(i=n.evaluator.exec({data:t,code:i,context:n.context})))e=i(e);else{if((isNull(o)||""===o)&&isObject(e[0]||""))return Logger.error("Invalid where-keys in “"+a+"” with “"+s+"” expression, at least one where-key to be provided when using list of object."),e;var u=[];forEach(e,(function(e){var t=!1;if(isNull(o))t=toStr(e).toLowerCase().includes(i.toLowerCase());else for(var r=o.split(",").map((function(e){return trim(e)})),a=0;a<r.length;a++){var s=r[a];if(toStr(n.evaluator.exec({data:e,code:s,context:n.context})).toLowerCase().includes(i.toLowerCase())){t=!0;break}}t&&u.push(e)})),e=u}return e}(e,o);Logger.error("Invalid “"+a+"” where expression “"+s+"”, at least a where-value and where-keys, or a filter-function must be provided")},b=ReactiveEvent.on("AfterGet",(function(t){n.binder.binds.push({isConnected:function(){return i.isConnected},watch:t.onChange((function(t,n,r){return function(t){if(c||l)return f();var n=(t=t||{}).method,r=t.args,o=u,a=function(){return Promise.resolve((function(t){var n=(g=g||v(trim(ifNullReturn(e.nodeValue,"")))).leftHandParts[1]||"_index_or_value";"_index_or_value"!==n&&forEach(t,(function(e,t){e.data[n]=t}))})).then((function(e){return e(u)}))};switch(n){case"pop":case"shift":if(isNull(m=o[n]()))return;if(removeEl(getRootElement(m.el)),"pop"===n)return;return a();case"splice":var s=r[0],d=r[1];forEach(o.splice(s,d),(function(e){return removeEl(getRootElement(e.el))}));var p=(g=g||v(trim(ifNullReturn(e.nodeValue,"")))).leftHandParts[1]||"_index_or_value";if(forEach([].slice.call(r,2),(function(e){s++,h({reference:getRootElement(u[s].el)||i,index:s,item:e})})),"_index_or_value"===p)return;for(;s<u.length;s++){var m;"number"==typeof(m=u[s].data)[p]&&(m[p]=s)}return;case"push":case"unshift":var b="unshift"==n,y=(u[0]||{}).el||i,C=b?0:o.length,N=b?getRootElement(y):i;return forEach([].slice.call(r),(function(e){var t=h({index:C++,reference:N,item:e});b&&(N=t)})),void(b&&a());default:return f()}}(r)}),e)})})),g=v(s),y=g.filters,C=function(e){return y.filter((function(t){return t.substring(0,e.length)===e}))},N=C("where");forEach(N,(function(e){return m(g.sourceValue,e)})),b.off(),(f=function(){var r=(g=g||v(trim(ifNullReturn(e.nodeValue,"")))).iterableExpression,i=C("order");forEach(u,(function(e){var t=getRootElement(e.el);t.parentElement&&o.removeChild(t)})),u=[],n.evaluator.exec({data:t,isReturn:!1,context:n.context,code:"var __e = __each, __fl = __filters, __f = __for; __f(__fl("+r+"), function($$itm, $$idx) { __e($$itm, $$idx); })",aditional:{__for:forEach,__each:function(e,t){return h({index:t,item:e})},__filters:function(e){var t=Extend.array(e);forEach(N,(function(e){return t=m(t,e)}));var n=function(e){var n=e.split(":").map((function(e){return trim(e)}));1==n.length?Logger.error("Invalid “"+a+"” order  expression “"+s+"”, at least the order type must be provided"):t=function(e,t,n){return l=!0,t||(t="asc"),e.sort((function(e,r){var o=function(e,n){if(isNull(e)||isNull(n))return 0;switch(toLower(t)){case"asc":return e?1:-1;case"desc":return n?-1:1;default:return Logger.log("The “"+t+"” order type is invalid: “"+s+"”. Available types are: “asc”  for order ascendent and “desc” for order descendent."),0}};return n?o(e[n]>r[n],r[n]<e[n]):o(e>r,r<e)}))}(t,n[1],n[2])};return forEach(i,(function(e){return n(e)})),t}}}),g=null})()}},e.prototype.def=function(e,t){var n=this.toOwnerNode(e),r=trim(ifNullReturn(e.nodeValue,""));if(""===r)return Logger.error(this.errorMsgEmptyNode(e));if(0!==this.delimiter.run(r).length)return Logger.error(this.errorMsgNodeValue(e));var o={},i=ReactiveEvent.on("AfterGet",(function(e){e.propName in o||(o[e.propName]=void 0),Prop.set(o,e.propName,e)})),a=this.evaluator.exec({data:t,code:r,context:this.context});if(!isObject(a))return Logger.error("Expected a valid Object Literal expression in “"+e.nodeName+"” and got “"+r+"”.");forEach(Object.keys(a),(function(e){e in o||(o[e]=a[e])})),ReactiveEvent.off("AfterGet",i.callback),this.bouer.set(o,t),n.removeAttribute(e.nodeName)},e.prototype.text=function(e){var t=this.toOwnerNode(e),n=trim(ifNullReturn(e.nodeValue,""));if(""===n)return Logger.error(this.errorMsgEmptyNode(e));t.textContent=n,t.removeAttribute(e.nodeName)},e.prototype.bind=function(e,t){var n=this.toOwnerNode(e),r=trim(ifNullReturn(e.nodeValue,""));return""===r?Logger.error(this.errorMsgEmptyNode(e)):0!==this.delimiter.run(r).length?Logger.error(this.errorMsgNodeValue(e)):(this.binder.create({node:e,isConnected:function(){return n.isConnected},fields:[{field:r,expression:r}],context:this.context,data:t}),void n.removeAttribute(e.nodeName))},e.prototype.property=function(e,t){var n=this,r=this.toOwnerNode(e),o=trim(ifNullReturn(e.nodeValue,"")),i=function(e){},a=function(e){return"Invalid value, expected an Object/Object Literal in “"+e.nodeName+"” and got “"+ifNullReturn(e.nodeValue,"")+"”."};if(""===o)return Logger.error(a(e));if(0===this.delimiter.run(o).length){var s=this.evaluator.exec({data:t,code:o,context:this.context});if(!isObject(s))return Logger.error(a(e));this.binder.create({data:t,node:e,isReplaceProperty:!1,context:this.context,fields:[{expression:o,field:o}],isConnected:function(){return r.isConnected},onUpdate:function(){return i(n.evaluator.exec({data:t,code:o,context:n.context}))}}),r.removeAttribute(e.nodeName),(i=function(t){var n=e.nodeName.substring(Constants.property.length),o=r.attributes[n];if(o||(r.setAttribute(n,""),o=r.attributes[n]),forEach(Object.keys(t),(function(e){if(!t[e])return o.value=trim(o.value.replace(e,""));o.value=o.value.includes(e)?o.value:trim(o.value+" "+e)})),""===o.value)return r.removeAttribute(n)})(s)}},e.prototype.data=function(e,t){var n=this.toOwnerNode(e),r=trim(ifNullReturn(e.nodeValue,""));if(0!==this.delimiter.run(r).length)return Logger.error("The “data” attribute cannot contain delimiter.");n.removeAttribute(e.nodeName);var o={},i=Extend.obj(t,{$data:t}),a=ReactiveEvent.on("AfterGet",(function(e){e.propName in o||(o[e.propName]=void 0),Prop.set(o,e.propName,e)}));if(""===r)o=Extend.obj(this.bouer.data);else{var s=this.evaluator.exec({data:i,code:r,context:this.context});if(!isObject(s))return Logger.error("Expected a valid Object Literal expression in “"+e.nodeName+"” and got “"+r+"”.");forEach(Object.keys(s),(function(e){e in o||(o[e]=s[e])}))}ReactiveEvent.off("AfterGet",a.callback);var u=e.nodeName.split(":")[1];return u&&(u=u.replace(/\[|\]/g,""),IoC.app(this.bouer).resolve(DataStore).set("data",u,o)),Reactive.transform({context:this.context,data:o}),this.compiler.compile({data:o,el:n,context:this.context})},e.prototype.href=function(e,t){var n=this,r=this.toOwnerNode(e),o=trim(ifNullReturn(e.nodeValue,""));if(""===o)return Logger.error(this.errorMsgEmptyNode(e));r.removeAttribute(e.nodeName);var i=urlCombine(ifNullReturn(this.bouer.config.usehash,!0)?"#":"",o);r.setAttribute("href",i);var a=r.attributes.href,s=this.delimiter.run(o);0!==s.length&&this.binder.create({data:t,node:a,isConnected:function(){return r.isConnected},context:this.context,fields:s}),r.addEventListener("click",(function(e){e.preventDefault(),IoC.app(n.bouer).resolve(Routing).navigate(a.value)}),!1)},e.prototype.entry=function(e,t){var n=this.toOwnerNode(e),r=trim(ifNullReturn(e.nodeValue,""));return""===r?Logger.error(this.errorMsgEmptyNode(e)):0!==this.delimiter.run(r).length?Logger.error(this.errorMsgNodeValue(e)):(n.removeAttribute(e.nodeName),void IoC.app(this.bouer).resolve(ComponentHandler).prepare([{name:r,template:n.outerHTML,data:t}]))},e.prototype.put=function(e,t){var n=this,r=this.toOwnerNode(e),o=trim(ifNullReturn(e.nodeValue,"")),i=function(){};return""===o?Logger.error(this.errorMsgEmptyNode(e)+" Direct <empty string> injection value is not allowed."):0!==this.delimiter.run(o).length?Logger.error("Expected an expression with no delimiter in “"+e.nodeName+"” and got “"+ifNullReturn(e.nodeValue,"")+"”."):(this.binder.create({data:t,node:e,isConnected:function(){return r.isConnected},fields:[{expression:o,field:o}],context:this.context,isReplaceProperty:!1,onUpdate:function(){return i()}}),r.removeAttribute(e.nodeName),void(i=function(){if(r.innerHTML="",""!==(o=trim(ifNullReturn(e.nodeValue,"")))){var i=createAnyEl(o).appendTo(r).build();IoC.app(n.bouer).resolve(ComponentHandler).order(i,t)}})())},e.prototype.req=function(e,t){var n=this,r=this.toOwnerNode(e),o=this.toOwnerNode(r),i=e.nodeName,a=trim(ifNullReturn(e.nodeValue,""));if(!a.includes(" of ")&&!a.includes(" as "))return Logger.error("Expected a valid “for” expression in “"+i+"” and got “"+a+'”.\nValid: e-req="item of url".');if(!r.hasAttribute("skeleton-cloned")){var s,u=this.delimiter.run(a),c={},l=(e.nodeName.split(":")[1]||"").replace(/\[|\]/g,""),f=createComment(void 0,"request-"+(l||code(6))),d=function(){},p={node:e,data:t,nodeName:i,nodeValue:a,fields:u,parent:r,value:a};o.insertBefore(f,r);var h=IoC.app(this.bouer).resolve(Skeleton);a.includes(" of ")&&h.insertItems(r),0!==u.length&&(p=this.binder.create({data:t,node:e,fields:u,context:this.context,isReplaceProperty:!1,isConnected:function(){return f.isConnected},onUpdate:function(){return d()}})),r.removeAttribute(e.nodeName),Prop.set(r,"isConnected",{get:function(){return f.isConnected}});var v=function(e){var o=r.attributes.getNamedItem(Constants.on+e);return o&&n.eventHandler.compile(o,t,n.context),{emit:function(t){n.eventHandler.emit({attachedNode:r,eventName:e,init:{detail:t}})}}},m=function(e){var t=e.split("|").map((function(e){return trim(e)})),n=t.shift().replace(/\(|\)/g,""),r=" of ",o=n.split(r);return o.length>1||(o=n.split(r=" as ")),{filters:t,type:trim(r),expression:trim(n),variables:trim(o[0]),path:trim(o[1])}},b=function(e,t){return e?"data"in e?"of"!==t||Array.isArray(e.data)?"as"!==t||"object"==typeof e.data||(Logger.error('Using e-req="... “as” ..." the response must be a list of items, and got “'+typeof e.data+"”."),!1):(Logger.error('Using e-req="... “of” ..." the response must be a list of items, and got “'+typeof e.data+"”."),!1):(Logger.error("the return must contain the “data” property. Example: { data: {} | [] }"),!1):(Logger.error("the return must be an object containing “data” property. Example: { data: {} | [] }"),!1)},g=IoC.app(this.bouer).resolve(Middleware);if(!g.has("req"))return Logger.error("There is no “req” middleware provided for the “e-req” directive requests.");var y=function(e){return{binder:p,detail:{requestType:e.type,requestPath:e.path,reponseData:c}}};(s=function(){var o=m(trim(e.nodeValue||""));v(Constants.builtInEvents.request).emit(),g.run("req",{type:"onBind",action:function(e){e(y(o),{success:function(e){!function(e){var i;if(b(e,o.type)){if(Reactive.transform({context:n.context,data:e}),l&&IoC.app(n.bouer).resolve(DataStore).set("req",l,e),v(Constants.builtInEvents.response).emit({response:e}),"data"in c)return c.data=e.data;if(c.data=void 0,Prop.transfer(c,e,"data"),"as"===o.type){var a=trim(o.variables.split(",")[0].replace(/\(|\)/g,""));return a in t?Logger.error("There is already a “"+a+"” defined in the current scope. Provide another variable name in order to continue."):(t[a]=e.data,n.compiler.compile({el:r,data:Reactive.transform({context:n.context,data:t}),context:n.context,isConnected:function(){return f.isConnected}}))}if("of"===o.type){h.clearItems(r);var s=code(8,"res"),u=o.expression.replace(o.path,s),d=Extend.obj(((i={})[s]=e.data,i),t);r.setAttribute(Constants.for,Extend.array([u],o.filters).join(" | ")),Prop.set(d,s,Prop.descriptor(e,"data")),n.compiler.compile({el:r,data:d,context:n.context,isConnected:function(){return f.isConnected}})}}}(e)},fail:function(e){return v(Constants.builtInEvents.fail).emit({error:e})},done:function(){return v(Constants.builtInEvents.done).emit()}})}})})(),d=function(){var t=m(trim(e.nodeValue||""));g.run("req",{type:"onUpdate",default:function(){return s()},action:function(e){e(y(t),{success:function(e){b(e,t.type)&&(c.data=e.data)},fail:function(e){return v(Constants.builtInEvents.fail).emit({error:e})},done:function(){return v(Constants.builtInEvents.done).emit()}})}})}}},e.prototype.wait=function(e){var t=this,n=this.toOwnerNode(e),r=trim(ifNullReturn(e.nodeValue,""));if(""===r)return Logger.error(this.errorMsgEmptyNode(e));if(0!==this.delimiter.run(r).length)return Logger.error(this.errorMsgNodeValue(e));n.removeAttribute(e.nodeName);var o=IoC.app(this.bouer).resolve(DataStore),i=o.wait[r];if(i){if(i.nodes.push(n),!i.data)return;forEach(i.nodes,(function(e){t.compiler.compile({el:e,context:i.context,data:Reactive.transform({context:i.context,data:i.data})})})),ifNullReturn(i.once,!1)&&delete o.wait[r]}return o.wait[r]={nodes:[n],context:this.context}},e.prototype.custom=function(e,t){var n=this.toOwnerNode(e),r=e.nodeName,o=trim(ifNullReturn(e.nodeValue,"")),i=this.delimiter.run(o),a=this.$custom[r],s=this.binder.create({data:t,node:e,fields:i,isReplaceProperty:!1,context:this.context,isConnected:function(){return n.isConnected},onUpdate:function(){"function"==typeof a.onUpdate&&a.onUpdate(e,s)}});ifNullReturn(a.removable,!0)&&n.removeAttribute(r);var u=r.split(".");u.shift();var c=(r.split(":")[1]||"").split(".")[0];return s.modifiers=u,s.argument=c,"function"==typeof a.onBind&&ifNullReturn(a.onBind(e,s),!1)},e.prototype.skeleton=function(e){var t;if(""===trim(ifNullReturn(e.nodeValue,""))){var n=this.toOwnerNode(e);n.removeAttribute(e.nodeName);var r=n.getAttribute("skeleton-clone-code");r&&(n.removeAttribute("skeleton-clone-code"),forEach([].slice.call(null===(t=this.bouer.el)||void 0===t?void 0:t.querySelectorAll('[="'+r+'"]')),(function(e){(e.parentElement||e.parentNode).removeChild(e)})))}},e}(),Compiler=function(){function e(e,t){this._IRT_=!0,this.NODES_TO_IGNORE_IN_COMPILATION={SCRIPT:1,"#comment":8},this.bouer=e,this.directives=null!=t?t:{},this.binder=IoC.app(e).resolve(Binder),this.delimiter=IoC.app(e).resolve(DelimiterHandler),this.eventHandler=IoC.app(e).resolve(EventHandler),this.component=IoC.app(e).resolve(ComponentHandler)}return e.prototype.compile=function(e){var t=this,n=e.el,r=e.context||this.bouer,o=e.data||this.bouer.data,i=e.isConnected||function(){return n.isConnected},a=IoC.app(this.bouer).resolve(Routing);if(!n)return Logger.error("Invalid element provided to the compiler.");if(!this.analize(n.outerHTML))return n;var s=new Directive(this.directives||{},this,r),u=function(n,o){if(!(n.nodeName in t.NODES_TO_IGNORE_IN_COMPILATION)){if(n instanceof Element){if(Constants.skip in n.attributes)return s.skip(n);if((n.localName.toLowerCase()===Constants.slot||n.tagName.toLowerCase()===Constants.slot)&&e.componentSlot){var c=e.componentSlot,l=function(e,t){var n=function(e){var n=e.cloneNode(!0);t.parentNode.insertBefore(n,t),u(n,o)};"SLOTCONTAINER"===e.nodeName||"SLOT"===e.nodeName?forEach(toArray(e.childNodes),(function(e){return n(e)})):n(e),t.parentNode.removeChild(t)};if(n.hasAttribute("default")){if(0==c.childNodes.length)return;return l(c,n)}if(n.hasAttribute("name")){var f=n.attributes.getNamedItem("name");return function e(t){var r=t.getAttribute(Constants.slot);return r&&r===f.value?(t.removeAttribute(Constants.slot),l(t,n)):0===t.children.length?null:void forEach(toArray(t.children),(function(t){e(t)}))}(c)}}if(Constants.def in n.attributes&&s.def(findDirective(n,Constants.def),o),Constants.entry in n.attributes&&s.entry(findDirective(n,Constants.entry),o),Constants.wait in n.attributes)return s.wait(findDirective(n,Constants.wait));if(Constants.for in n.attributes)return s.for(findDirective(n,Constants.for),o);if(t.component.check(n.localName))return t.component.order(n,o);if(Constants.if in n.attributes)return s.if(findDirective(n,Constants.if),o);(Constants.elseif in n.attributes||Constants.else in n.attributes)&&Logger.warn("The “"+Constants.elseif+"” or “"+Constants.else+"” requires an element with “"+Constants.if+"” above."),Constants.show in n.attributes&&s.show(findDirective(n,Constants.show),o);var d;if(d=findDirective(n,Constants.req))return s.req(d,o);var p;if(p=findDirective(n,Constants.data))return s.data(p,o);if(Constants.put in n.attributes)return s.put(findDirective(n,Constants.put),o);if(a.routeView===n)return;forEach(toArray(n.attributes),(function(e){u(e,o)}))}if(Constants.check(n,Constants.href))return s.href(n,o);if(Constants.check(n,Constants.text))return s.text(n);if(Constants.check(n,Constants.bind))return s.bind(n,o);if(!Object.keys(s.$custom).find((function(e){return Constants.check(n,e)}))||!s.custom(n,o)){if(Constants.check(n,Constants.property)&&!Constants.isConstant(n.nodeName)&&s.property(n,o),Constants.check(n,Constants.skeleton)&&s.skeleton(n),Constants.check(n,Constants.on))return t.eventHandler.compile(n,o,r);var h,v;if(h=t.delimiter.shorthand(n.nodeName)){var m=n.ownerElement||n.parentNode,b=DOM.createAttribute("e-"+h.expression);return b.value="{{ "+h.expression+" }}",m.attributes.setNamedItem(b),m.attributes.removeNamedItem(h.field),t.binder.create({node:b,isConnected:i,fields:[{expression:h.expression,field:b.value}],context:r,data:o})}isString(n.nodeValue)&&(v=t.delimiter.run(n.nodeValue))&&0!==v.length&&t.binder.create({node:n,isConnected:i,fields:v,context:r,data:o}),forEach(toArray(n.childNodes),(function(e){return u(e,o)}))}}};return u(n,o),n.hasAttribute&&n.hasAttribute(Constants.silent)&&n.removeAttribute(Constants.silent),isFunction(e.onDone)&&fnCall(e.onDone.call(r,n)),this.eventHandler.emit({eventName:Constants.builtInEvents.compile,attachedNode:n,once:!0,init:{detail:o}}),n},e.prototype.analize=function(e){for(var t="<([a-z0-9-_]{1,}|/[a-z0-9-_]{1,})((.|\n|\r)*?)>",n=e.replace(/<script((.|\n|\r)*?)<\/script>/gm,"<script><\/script>").replace(/<style((.|\n|\r)*?)<\/style>/gm,"<style></style>").replace(/<pre((.|\n|\r)*?)<\/pre>/gm,"<pre></pre>").replace(/<code((.|\n|\r)*?)<\/code>/gm,"<code></code>").replace(/<svg((.|\n|\r)*?)<\/svg>/gm,"<svg></svg>").replace(/<!--((.|\n|\r)*?)-->/gm,"").replace(/&nbsp;/g,"&#160;"),r=[],o=[],i=0,a="",s=!0,u=n.match(new RegExp(t,"ig"))||[],c=new Set(["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"]),l=0;l<u.length;l++){var f=u[l],d=toLower(f.match(new RegExp(t,"i"))[1]),p="/"===f[1];if(r.push({tag:f,ident:p?i:++i}),!c.has(d))if(o.push({name:d,tag:f}),p){if(i--,!s)continue;var h=o.pop(),v=o.pop();v&&v.name===h.name.substring(1)||(i++,a="Syntax Error: Unexpected token, the openning tag `"+(v.tag||"NoToken")+"` does not match with closing tag: `"+h.tag+"`:\n\n",s=!1,r.push(r[r.length-1]),r[r.length-2]={tag:"<====================== Line Error ======================",ident:i+1})}else;}return s||Logger.error(a+r.map((function(e,t){return t+1+"."+Array(e.ident).fill("  ").join("")+e.tag})).join("\n")),s},e}(),UriHandler=function(){function e(e){this._IRT_=!0,this.url=e||DOM.location.href}return e.prototype.params=function(e){var t={};if(e&&isString(e)){var n=this.url.split("?")[0].split("/").reverse();""===n[0]&&n.shift(),forEach(e.split("/").reverse(),(function(e,r){var o=RegExp("{([\\S\\s]*?)}","ig").exec(e);Array.isArray(o)&&(t[o[1]]=n[r])}))}var r=this.url.split("?")[1];return r?(forEach(r.split("&"),(function(e){var n=e.split("=");t[n[0]]=(n[1]||"").split("#")[0]})),t):this},e.prototype.add=function(e){var t=[];forEach(Object.keys(e),(function(n){t.push(n+"="+e[n])}));var n=t.join("&");return this.url.includes("?")?"&"+n:"?"+n},e.prototype.remove=function(e){return e},e}(),Component=function(){function e(e){this._IRT_=!0,this.isDestroyed=!1,this.children=[],this.assets=[],this.events=[];var t=void 0,n=void 0,r=void 0;isString(e)?n=e:(t=e.name,n=e.path,r=e.data,Object.assign(this,e)),this.name=t||"",this.path=n||"",this.data=Reactive.transform({context:this,data:r||{}});var o={value:e.template};Prop.set(this,"template",{get:function(){return o.value},set:function(e){return o.value=e}})}return e.prototype.export=function(e){var t=this;return isObject(e)?forEach(Object.keys(e),(function(n){t.data[n]=e[n],Prop.transfer(t.data,e,n)})):Logger.log('Invalid object for component.export(...), only "Object Literal" is allowed.')},e.prototype.destroy=function(){var e=this;if(!this.el)return!1;if(!(this.isDestroyed&&this.bouer&&this.bouer.isDestroyed)){this.keepAlive||(this.isDestroyed=!0),this.emit("beforeDestroy");var t=this.el.parentElement;t&&t.removeChild(this.el),this.emit("destroyed"),forEach(this.events,(function(t){return e.off(t.eventName,t.callback)})),this.events=[];var n=IoC.app(this.bouer).resolve(ComponentHandler).activeComponents;n.splice(n.indexOf(this),1)}},e.prototype.params=function(){return(new UriHandler).params(this.route)},e.prototype.emit=function(e,t){IoC.app(this.bouer).resolve(EventHandler).emit({eventName:e,attachedNode:this.el,init:t})},e.prototype.on=function(e,t){var n=new Set(["created","beforeMount","mounted","beforeLoad","loaded","beforeDestroy","destroyed"]);new Set(["requested","blocked","failed"]).has(e)&&Logger.warn("The “"+e+"” Event is called before the component is mounted, to be dispatchedit needs to be on registration object: { "+e+": function(){ ... }, ... }.");var r=IoC.app(this.bouer).resolve(EventHandler).on({eventName:e,callback:t,attachedNode:this.el,context:this,modifiers:{once:n.has(e),autodestroy:!1}});return this.events.push(r),r},e.prototype.off=function(e,t){IoC.app(this.bouer).resolve(EventHandler).off({eventName:e,callback:t,attachedNode:this.el}),this.events=where(this.events,(function(n){return!(n.eventName==e&&n.callback==t)}))},e.prototype.addAssets=function(e){var t=[],n={js:"script",css:"link",scss:"link",sass:"link",less:"link",styl:"link",style:"link"},r=function(e,t){var n=!(!e&&!trim(e));return n||Logger.error("Invalid asset “src”, in assets["+t+"].src"),n},o=function(e,t){var r=e.split("."),o=n[toLower(r[r.length-1])];return o||Logger.error("Couldn't find out what type of asset it is, provide the “type” explicitly at assets["+t+"].type")};forEach(e,(function(e,i){var a="",s="",u=!0;if("string"==typeof e){if(!r(e,i))return;s=o(trim(a=e.replace(/\.less|\.s[ac]ss|\.styl/i,".css")),i)}else{if(!r(trim(a=e.src.replace(/\.less|\.s[ac]ss\.styl/i,".css")),i))return;if(e.type)s=n[toLower(e.type)]||e.type;else if(!(s=o(a,i)))return;u=ifNullReturn(e.scoped,!0)}if("."!==a[0]){var c=urlResolver(a),l=c.baseURI===a.substring(0,c.baseURI.length);a=urlCombine(l?c.origin:c.baseURI,c.pathname)}var f=createAnyEl(s,(function(e){switch(ifNullReturn(u,!0)&&e.setAttribute("scoped","true"),toLower(s)){case"script":default:e.setAttribute("src",a);break;case"link":e.setAttribute("href",a),e.setAttribute("rel","stylesheet"),e.setAttribute("type","text/css")}})).build();t.push(f)})),this.assets.push.apply(this.assets,t)},e.prototype.set=function(e,t){var n=this,r=setData(this,e,t);return forEach(Object.keys(e),(function(t){return Prop.transfer(n,e,t)})),r},e}(),ComponentHandler=function(){function e(e){this._IRT_=!0,this.requests={},this.components={},this.stylesController={},this.activeComponents=[],this.bouer=e,this.delimiter=IoC.app(e).resolve(DelimiterHandler),this.eventHandler=IoC.app(e).resolve(EventHandler),this.evaluator=IoC.app(e).resolve(Evaluator)}return e.prototype.check=function(e){return e in this.components},e.prototype.request=function(e,t){var n=this;if(!isNull(this.requests[e]))return this.requests[e].push(t);this.requests[e]=[t];var r=urlResolver(e),o=null!=DOM.head.querySelector("base");webRequest(urlCombine(r.baseURI===e.substring(0,r.baseURI.length)?r.origin:r.baseURI,r.pathname),{headers:{"Content-Type":"text/plain"}}).then((function(e){if(!e.ok)throw new Error(e.statusText);return e.text()})).then((function(t){forEach(n.requests[e],(function(n){n.success(t,e)})),delete n.requests[e]})).catch((function(t){o||Logger.warn('It seems like you are not using the “<base href="/base/components/path/" />” element, try to add as the first child into “<head></head>” element.'),forEach(n.requests[e],(function(n){return n.fail(t,e)})),delete n.requests[e]}))},e.prototype.prepare=function(e,t){var n=this;forEach(e,(function(e,r){var o=e.prototype instanceof Component,i=e;if(o&&((i=IoC.app(n.bouer).resolve(e)||IoC.new(e)).clazz=e),(!i.path||isNull(i.path))&&(!i.template||isNull(i.template)))return Logger.warn("The component at options.components["+r+"] has not valid “path” or “template” property defined, then it was ignored.");if(isNull(i.name)||!i.name){if(!i.path||isNull(i.path))return Logger.warn("Provide a “name” to component at options.components["+r+"] position.");var a=i.path.toLowerCase().split("/"),s=a[a.length-1].replace(".html","");n.components[s]&&(s=toLower(code(8,s+"-component-"))),i.name=s}i.name=i.name.toLowerCase();var u="";if(n.components[i.name])return Logger.warn("The component name “"+i.name+"” is already define, try changing the name.");isNull(t)||(u=t.route||""),isNull(i.route)||(i.route="/"+urlCombine(u,i.route)),Array.isArray(i.children)&&n.prepare(i.children,i),IoC.app(n.bouer).resolve(Routing).configure(n.components[i.name]=i);var c=function(e){e&&n.request(i.path,{success:function(e){i.template=e},fail:function(e){Logger.error(buildError(e))}})};return isNull(i.prefetch)?(i.prefetch=ifNullReturn(n.bouer.config.prefetch,!0))?c(i.path):void 0:!0===i.prefetch?c(i.path):void 0}))},e.prototype.order=function(e,t,n){var r=this,o=toLower(e.nodeName),i=this.components[o];if(!i)return Logger.error("No component with name “"+o+"” registered.");var a=function(){var a=function(e){var t;return!0===(t=e instanceof Component&&e.clazz?IoC.app(r.bouer).resolve(e.clazz)||IoC.new(e.clazz):e instanceof Component?copyObject(e):new Component(e)).keepAlive&&(r.components[o]=t),t.template=e.template,t.bouer=r.bouer,t};return i.template?r.insert(e,a(i),t,n):i.path?(r.addEvent("requested",e,i,r.bouer).emit(),void r.request(i.path,{success:function(o){i.template=o,r.insert(e,a(i),t,n)},fail:function(t){Logger.error("Failed to request <"+o+"/> component with path “"+i.path+"”."),Logger.error(buildError(t)),r.addEvent("failed",e,i,r.bouer).emit()}})):Logger.error("Expected a valid value in `path` or `template` got invalid value at “"+o+"” component.")};if(i.restrictions&&i.restrictions.length>0){var s=[],u=i.restrictions.map((function(e){var t=e.call(r.bouer,i);return!1===t?s.push(e):t instanceof Promise&&t.then((function(t){!1===t&&s.push(e)})).catch((function(){return s.push(e)})),t})),c=this.addEvent("blocked",e,i,this.bouer),l=function(){return c.emit({detail:{component:i.name,message:"Component “"+i.name+"” blocked by restriction(s)",blocks:s}})};return Promise.all(u).then((function(e){e.every((function(e){return 1==e}))?a():l()})).catch((function(){return l()}))}return a()},e.prototype.find=function(e){for(var t=Object.keys(this.components),n=0;n<t.length;n++){var r=this.components[t[n]];if(e(r))return r}return null},e.prototype.addEvent=function(e,t,n,r){var o=this,i=n[e];"function"==typeof i&&this.eventHandler.on({eventName:e,callback:function(e){return i.call(r||n,e)},attachedNode:t,modifiers:{once:!0},context:r||n});return{emit:function(r){return function(r){o.eventHandler.emit({attachedNode:t,once:!0,eventName:e,init:r}),o.eventHandler.emit({eventName:"component:"+e,init:{detail:{component:n}},once:!0})}(r)}}},e.prototype.insert=function(e,t,n,r){var o=this,i=toLower(e.nodeName),a=e.parentElement,s=IoC.app(this.bouer).resolve(Compiler);if(a){if(isNull(t.template))return Logger.error("The <"+i+"/> component is not ready yet to be inserted.");if(s.analize(t.template)){this.activeComponents.includes(t)||this.activeComponents.push(t);var u=createAnyEl("SlotContainer",(function(t){t.innerHTML=e.innerHTML,e.innerHTML=""})).build();(!1===(e.hasAttribute("keep-alive")||ifNullReturn(t.keepAlive,!1))||isNull(t.el))&&createEl("body",(function(e){return e.innerHTML=t.template,forEach([].slice.call(e.children),(function(n){-1!==["SCRIPT","LINK","STYLE"].indexOf(n.nodeName)&&(t.assets.push(n),e.removeChild(n))})),0===e.children.length?Logger.error("The component <"+i+"/> seems to be empty or it has not a root element. Example: <div></div>, to be included."):e.children.length>1?Logger.error("The component <"+i+"/> seems to have multiple root element, it must have only one root."):void(t.el=e.children[0])}));var c=t.el;if(!isNull(c)){var l=where(Object.keys(t),(function(e){return!(e in t)}));l.length>0&&Reactive.transform({context:t,data:t,keys:l});var f=this.addEvent("created",c,t),d=this.addEvent("beforeMount",c,t),p=this.addEvent("mounted",c,t),h=this.addEvent("beforeLoad",c,t),v=this.addEvent("loaded",c,t);this.addEvent("beforeDestroy",c,t),this.addEvent("destroyed",c,t);var m=where(t.assets,(function(e){return"SCRIPT"===e.nodeName})),b=t.init;isFunction(b)&&fnCall(b.call(t));var g=function(l){try{findDirective(e,Constants.data)||e.setAttribute("data","$data");var m;if(m=findDirective(e,Constants.data)){var b=m;0!==o.delimiter.run(b.value).length?Logger.error("The “data” attribute cannot contain delimiter, source element: <"+i+"/>."):function(e){var r={},i=Extend.obj(n,{$data:n}),a=ReactiveEvent.on("AfterGet",(function(e){e.propName in r||(r[e.propName]=void 0),Prop.set(r,e.propName,e)}));if(""===e.value)r=Extend.obj(o.bouer.data);else{var s=IoC.app(o.bouer).resolve(Evaluator).exec({data:i,code:e.value,context:o.bouer});isObject(s)?forEach(Object.keys(s),(function(e){e in r||(r[e]=s[e])})):Logger.error("Expected a valid Object Literal expression in “"+e.nodeName+"” and got “"+e.value+"”.")}a.off(),r=Reactive.transform({context:t,data:r}),forEach(Object.keys(r),(function(e){Prop.transfer(t.data,r,e)}))}(b),e.removeAttribute(b.name)}IoC.app(o.bouer).resolve(Evaluator).execRaw(l||"",t),f.emit(),forEach(toArray(e.attributes),(function(t){if(e.removeAttribute(t.name),"class"===t.nodeName)return e.classList.forEach((function(e){c.classList.add(e)}));c.attributes.setNamedItem(t)})),d.emit(),"root"in e||Prop.set(e,"root",{value:c}),a.replaceChild(c,e),p.emit();var g={};c.classList.forEach((function(e){return g[e]=!0}));var y=function(e,t){var n=[],r="STYLE"===e.nodeName;if(e.sheet){for(var o=e.sheet.cssRules,i=0;i<o.length;i++){var a=o.item(i);if(a){var s=a,u=s.selectorText;if(u){var l=u.split(" ")[0],f="."==l[0]||"#"==l[0]?l.substring(1):l,d=g[f]?"":" ",p="."+t,h=s.selectorText.split(" ");h[0]===toLower(c.tagName)&&h.shift(),s.selectorText=p+d+h.join(" ")}r&&n.push(s.cssText)}}r&&(e.innerText=n.join(" "))}},C=where(t.assets,(function(e){return"SCRIPT"!==e.nodeName})),N="component-style";if(forEach(C,(function(e){var n=e.cloneNode(!0);if(n instanceof HTMLLinkElement){var r="/"===t.path[0]?t.path.substring(1):t.path;n.href=pathResolver(r,n.getAttribute("href")||""),n.rel="stylesheet"}if(o.stylesController[i]){var a=o.stylesController[i];if(a.elements.indexOf(c)>-1)return;return a.elements.push(c),forEach(a.styles,(function(e){c.classList.add(e.getAttribute(N))}))}var s=code(7,"bouer-s");if(n.setAttribute(N,s),n instanceof HTMLLinkElement&&n.hasAttribute("scoped")&&(n.onload=function(e){return y(e.target,s)}),o.stylesController[i]={styles:[DOM.head.appendChild(n)],elements:[c]},n.hasAttribute("scoped"))return c.classList.add(s),n instanceof HTMLStyleElement?y(n,s):void 0})),h.emit(),s.compile({data:Reactive.transform({context:t,data:t.data}),onDone:function(){isFunction(r)&&r(t),v.emit()},componentSlot:u,context:t,el:c}),!1===ifNullReturn(o.bouer.config.autoComponentDestroy,!0))return;Task.run((function(e){if(!t.el.isConnected){if(o.bouer.isDestroyed)return e();t.destroy(),e();var n=o.stylesController[t.name];if(n){var r=n.elements.indexOf(t.el);n.elements.splice(r,1),n.elements.length>0||a.isConnected||(forEach(n.styles,(function(e){return forEach(toArray(DOM.head.children),(function(t){if(t===e)return DOM.head.removeChild(e)}))})),delete o.stylesController[t.name])}}}))}catch(e){Logger.error("Error in <"+i+"/> component."),Logger.error(buildError(e))}};if(0===m.length)return g();var y=[],C=[],N=[],E={};return forEach(m,(function(e){if(""==e.src||e.innerHTML)y.push(e.innerHTML);else{var n="/"===t.path[0]?t.path.substring(1):t.path;e.src=pathResolver(n,e.getAttribute("src")||""),N.push(e.src)}})),0==N.length?g(y.join("\n\n")):forEach(N,(function(e,t){E[e]=!0,webRequest(e,{headers:{"Content-Type":"text/plain"}}).then((function(e){if(!e.ok)throw new Error(e.statusText);return e.text()})).then((function(n){if(delete E[e],C[t]=n,0===Object.keys(E).length)return g(Extend.array(C,y).join("\n\n"))})).catch((function(t){t.stack="",Logger.error("Error loading the <script src='"+e+"'><\/script> in <"+i+"/> component, remove it in order to be compiled."),Logger.log(t)}))}))}}}},e}(),ViewChild=function(){function e(){}return e.by=function(e,t){return where(IoC.app(e).resolve(ComponentHandler).activeComponents,t)},e.byId=function(e,t){return where(IoC.app(e).resolve(ComponentHandler).activeComponents,(function(e){return e.el&&getRootElement(e.el).id==t}))[0]},e.byName=function(e,t){return where(IoC.app(e).resolve(ComponentHandler).activeComponents,(function(e){return e.name.toLowerCase()==(t||"").toLowerCase()}))},e}(),Bouer=function(){function e(e,t){var n=this;this._IRT_=!0,this.name="Bouer",this.version="3.1.0",this.__id__=IoC.newId(),this.refs={},this.isDestroyed=!1,this.isInitialized=!1;var r=this;this.options=t=t||{},this.config=t.config||{},this.deps=t.deps||{},forEach(Object.keys(this.deps),(function(e){var t=n.deps,r=t[e];t[e]="function"==typeof r?r.bind(n):r}));var o=t.delimiters||[];IoC.app(this).add(DataStore,[this],!0),IoC.app(this).add(Evaluator,[this],!0),IoC.app(this).add(Middleware,[this],!0),IoC.app(this).add(Binder,[this],!0),IoC.app(this).add(EventHandler,[this],!0),IoC.app(this).add(ComponentHandler,[this],!0),IoC.app(this).add(Skeleton,[this],!0),IoC.app(this).add(Routing,[this],!0),IoC.app(this).add(DelimiterHandler,[this,o],!0),IoC.app(this).add(Compiler,[this,t.directives],!0);var i=IoC.app(this).resolve(DataStore),a=IoC.app(this).resolve(Middleware),s=IoC.app(this).resolve(ComponentHandler),u=IoC.app(this).resolve(Compiler),c=IoC.app(this).resolve(Skeleton),l=IoC.app(this).resolve(DelimiterHandler);"function"==typeof t.middleware&&t.middleware.call(r,a.subscribe,r),this.data=Reactive.transform({data:t.data||{},context:r}),this.globalData=Reactive.transform({data:t.globalData||{},context:r}),o.push.apply(o,[{name:"html",delimiter:{open:"{{:html ",close:"}}"}},{name:"common",delimiter:{open:"{{",close:"}}"}}]),this.$routing=IoC.app(this).resolve(Routing),this.$delimiters={add:l.add,remove:l.remove,get:function(){return l.delimiters.slice()}},this.$data={get:function(e){return e?i.data[e]:null},set:function(e,t,o){return e in i.data?Logger.log("There is already a data stored with this key “"+e+"”."):(!0===ifNullReturn(o,!1)&&Reactive.transform({context:r,data:t}),IoC.app(n).resolve(DataStore).set("data",e,t))},unset:function(e){return delete i.data[e]}},this.$req={get:function(e){return e?i.req[e]:void 0},unset:function(e){return delete i.req[e]}},this.$wait={get:function(e){if(e){var t=i.wait[e];if(t)return ifNullReturn(t.once,!0)&&n.$wait.unset(e),t.data}},set:function(e,t,o){if(!(e in i.wait))return i.wait[e]={data:t,nodes:[],once:ifNullReturn(o,!1),context:r};var a=i.wait[e];a.data=t,forEach(a.nodes,(function(e){e&&u.compile({el:e,context:a.context,data:Reactive.transform({context:a.context,data:a.data})})})),ifNullReturn(o,!1)&&n.$wait.unset(e)},unset:function(e){return delete i.wait[e]}},this.$skeleton={clear:function(e){return c.clear(e)},set:function(e){return c.init(e)}},this.$components={add:function(e){return s.prepare([e])},get:function(e){return s.components[e]},viewBy:function(e){return ViewChild.by(n,e)},viewByName:function(e){return ViewChild.byName(n,e)},viewById:function(e){return ViewChild.byId(n,e)}},Prop.set(this,"refs",{get:function(){var e={};return forEach(toArray(ifNullStop(n.el).querySelectorAll("["+Constants.ref+"]")),(function(t){var n=trim(t.attributes[Constants.ref].value)||t.name||"";return""===n?Logger.error("Expected an expression in “"+t.name+"” or at least “name” attribute to combine with “"+t.name+"”."):n in e?(Logger.warn("The key “"+n+"” in “"+t.name+"” is taken, choose another key."),Logger.warn(t)):void(e[n]=t)})),e}}),s.prepare(t.components||[]),isNull(e)||""===trim(e)||this.init(e)}return e.create=function(t){return(t=t||{}).config=t.config||{},(t.config||{}).autoUnbind=!1,(t.config||{}).autoOffEvent=!1,(t.config||{}).autoComponentDestroy=!1,new e("",t)},e.toJsObj=function(e,t,n){return htmlToJsObj(e,t,n)},e.prototype.init=function(e){var t=this;if(this.isInitialized)return this;if(isNull(e)||""===trim(e))throw Logger.error(new Error("Invalid selector provided to the instance."));var n=this,r=DOM.querySelector(e);if(!(this.el=r))throw Logger.error(new SyntaxError("Element with selector “"+e+"” not found."));var o=this.options||{},i=IoC.app(this).resolve(Binder),a=IoC.app(this).resolve(EventHandler),s=IoC.app(this).resolve(Routing),u=IoC.app(this).resolve(Skeleton),c=IoC.app(this).resolve(Compiler);return forEach([o.beforeLoad,o.loaded,o.beforeDestroy,o.destroyed],(function(e){"function"==typeof e&&a.on({eventName:e.name,callback:e,attachedNode:r,modifiers:{once:!0},context:n})})),a.emit({eventName:"beforeLoad",attachedNode:r}),(o.config||{}).autoUnbind=!0,(o.config||{}).autoOffEvent=!0,(o.config||{}).autoComponentDestroy=!0,s.init(),u.init((o.config||{}).skeleton),i.cleanup(),a.cleanup(),this.isInitialized=!0,c.compile({el:this.el,data:this.data,context:this,onDone:function(){return a.emit({eventName:"loaded",attachedNode:r})}}),WIN.addEventListener("beforeunload",(function(){t.isDestroyed||(a.emit({eventName:"beforeDestroy",attachedNode:r}),t.destroy())}),{once:!0}),Task.run((function(e){if(t.isDestroyed)return e();r.isConnected||(a.emit({eventName:"beforeDestroy",attachedNode:r}),t.destroy(),e())})),DOM.head.querySelector('link[rel~="icon"]')||createEl("link",(function(e){e.rel="icon",e.type="image/png",e.href="https://afonsomatelias.github.io/assets/bouer/img/short.png"})).appendTo(DOM.head),this},e.prototype.set=function(e,t){return setData(this,e,t)},e.prototype.toJsObj=function(e,t,n){return htmlToJsObj(e,t,n)},e.prototype.watch=function(e,t,n){return IoC.app(this).resolve(Binder).onPropertyChange(e,t,n||this.data)},e.prototype.react=function(e){return IoC.app(this).resolve(Binder).onPropertyInScopeChange(e)},e.prototype.on=function(e,t,n){return IoC.app(this).resolve(EventHandler).on({eventName:e,callback:t,attachedNode:(n||{}).attachedNode,modifiers:(n||{}).modifiers,context:this})},e.prototype.off=function(e,t,n){return IoC.app(this).resolve(EventHandler).off({eventName:e,callback:t,attachedNode:n})},e.prototype.unbind=function(e,t,n){return IoC.app(this).resolve(Binder).remove(e,n,t)},e.prototype.emit=function(e,t){var n=t||{};return IoC.app(this).resolve(EventHandler).emit({eventName:e,attachedNode:n.element,init:n.init,once:n.once})},e.prototype.lazy=function(e,t){var n,r=this;t=isNull(t)?500:t;var o=arguments[2];return function(){var i=[].slice.call(arguments),a=o&&!n;clearTimeout(n),n=setTimeout((function(){n=null,o||e.apply(r,i)}),t),a&&e.apply(r,i)}},e.prototype.compile=function(e){return IoC.app(this).resolve(Compiler).compile({el:e.el,data:e.data,context:e.context||this,onDone:e.onDone})},e.prototype.destroy=function(){var e=this.el,t=IoC.app(this).resolve(EventHandler).$events,n=(t.destroyed||[]).concat(t["component:destroyed"]||[]);this.emit("destroyed",{element:this.el}),forEach(n,(function(e){return e.emit({once:!0})})),t.destroyed=[],t["component:destroyed"]=[],"BODY"==e.tagName?e.innerHTML="":DOM.contains(e)&&e.parentElement.removeChild(e),this.isDestroyed=!0,this.isInitialized=!1,IoC.app(this).clear()},e}();export{Compiler,Component,DOM,Extend,IoC,Prop,Reactive,Routing,ViewChild,WIN,Watch,anchor,buildError,code,copyObject,createAnyEl,createComment,createEl,Bouer as default,findAttribute,findDirective,fnCall,fnEmpty,forEach,getRootElement,htmlToJsObj,ifNullReturn,ifNullStop,isEmptyObject,isFilledObj,isFunction,isNull,isObject,isPrimitive,isString,mapper,pathResolver,removeEl,setData,startWith,toArray,toLower,toStr,trim,urlCombine,urlResolver,webRequest,where};